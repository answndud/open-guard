# OpenGuard Sample Policy
# This is an example least-privilege policy for a typical Node.js project skill.
# Generated by: openguard policy generate ./my-skill

version: v1

metadata:
  name: "nodejs-skill-policy"
  description: "Least-privilege policy for a Node.js-based AI agent skill"
  created: "2026-02-09T00:00:00Z"
  author: "openguard-policy-generator"

defaults:
  action: deny
  require_approval_for:
    - shell_exec
    - new_domain
    - credential_paths

allow:
  commands:
    # Version control
    - cmd: "git"
      args: ["clone", "**"]
      description: "Allow git clone operations"
    - cmd: "git"
      args: ["checkout", "*"]
      description: "Allow git checkout"
    - cmd: "git"
      args: ["pull", "**"]
      description: "Allow git pull"
    - cmd: "git"
      args: ["status"]
      description: "Allow git status"
    - cmd: "git"
      args: ["diff", "**"]
      description: "Allow git diff"
    - cmd: "git"
      args: ["log", "**"]
      description: "Allow git log"

    # Node.js / npm
    - cmd: "node"
      args: ["**"]
      description: "Allow node execution"
    - cmd: "npm"
      args: ["install", "**"]
      description: "Allow npm install"
    - cmd: "npm"
      args: ["run", "*"]
      description: "Allow npm run scripts"
    - cmd: "npm"
      args: ["test"]
      description: "Allow npm test"
    - cmd: "npx"
      args: ["**"]
      description: "Allow npx execution"
    - cmd: "pnpm"
      args: ["install", "**"]
      description: "Allow pnpm install"
    - cmd: "pnpm"
      args: ["run", "*"]
      description: "Allow pnpm run scripts"

    # Common utilities
    - cmd: "cat"
      args: ["./**"]
      description: "Allow reading project files"
    - cmd: "ls"
      args: ["**"]
      description: "Allow listing directories"
    - cmd: "mkdir"
      args: ["-p", "./**"]
      description: "Allow creating project directories"
    - cmd: "cp"
      args: ["./**", "./**"]
      description: "Allow copying within project"
    - cmd: "echo"
      args: ["**"]
      description: "Allow echo"

  paths:
    read:
      - "./**"                          # Project directory
      - "~/.config/openguard/**"        # OpenGuard config
      - "~/.npmrc"                      # npm config (read only)
      - "/tmp/openguard-*/**"           # Temp working dirs
    write:
      - "./**"                          # Project directory
      - "/tmp/openguard-*/**"           # Temp working dirs
      - "~/.npm/_cacache/**"            # npm cache

  network:
    domains:
      - "github.com"
      - "*.github.com"
      - "registry.npmjs.org"
      - "*.npmjs.org"
      - "nodejs.org"
    ports:
      - 443
      - 80

# Hard deny - these override allow rules
deny:
  commands:
    - cmd: "rm"
      args: ["-rf", "/"]
    - cmd: "rm"
      args: ["-rf", "~"]
    - cmd: "sudo"
      args: ["**"]
    - cmd: "su"
      args: ["**"]
  paths:
    - "~/.ssh/**"
    - "~/.aws/**"
    - "~/.gnupg/**"
    - "~/.kube/**"
    - "~/.config/gcloud/**"
    - "~/Library/Keychains/**"
    - "~/.password-store/**"
    - "~/.env"
    - "**/.env"
    - "**/.env.local"
  network:
    domains:
      - "*.burpcollaborator.net"

# Approval gate configuration
approvals:
  shell_exec:
    mode: "2-step"
    except_allowlisted: true
  new_domain:
    mode: "prompt"
    except_allowlisted: true
  credential_paths:
    mode: "deny"
  file_write:
    mode: "auto"
    except_allowlisted: true
  elevated_privilege:
    mode: "deny"
